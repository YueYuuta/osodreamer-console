<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OsoDreamer Console - Features Demo</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
            background: #222;
            color: #eee;
        }

        button {
            cursor: pointer;
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            font-weight: bold;
        }

        .group {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        h2 {
            margin-top: 0;
        }
    </style>
</head>

<body>
    <h1>Console Features Demo</h1>

    <div class="group">
        <h2>1. Log Deduplication</h2>
        <p>Clicking this will log "Hello World" 10 times instantly. Notice the badge count instead of 10 rows.</p>
        <button onclick="triggerLoop()" style="background:#3b82f6;color:white">Log "Hello" x10</button>
        <button onclick="triggerObjectLoop()" style="background:#60a5fa;color:white">Log Object x5</button>
    </div>

    <div class="group">
        <h2>2. Error Handling</h2>
        <p>These buttons throw real errors. Open the console to see the stack trace rendering.</p>
        <button onclick="throwError()" style="background:#ef4444;color:white">Throw Error</button>
        <button onclick="throwAsyncError()" style="background:#f87171;color:white">Async Error (Promise)</button>
    </div>

    <div class="group">
        <h2>3. Deep Objects</h2>
        <button onclick="logDeepObject()" style="background:#10b981;color:white">Log Deep Object</button>
    </div>

    <div class="group">
        <h2>4. Stress Test (Performance)</h2>
        <p>Adds 500 logs in 5ms intervals. Watch the list update smoothly thanks to incremental rendering.</p>
        <button onclick="startStressTest()" style="background:#8b5cf6;color:white">Run Stress Test (500 logs)</button>
    </div>

    <div class="group">
        <h2>5. Network Robustness</h2>
        <p>Test FormData (File uploads) and proper Error catching.</p>
        <button onclick="sendFormData()" style="background:#f59e0b;color:white">Send FormData (Fake Upload)</button>
        <button onclick="sendFetchError()" style="background:#dc2626;color:white">Trigger Fetch Error (Invalid
            Domain)</button>
    </div>

    <div class="group">
        <h2>6. Large Data Test</h2>
        <p>Log an array with 1000 items. Should render instantly (only 50 first) and offer "Show more".</p>
        <button onclick="logLargeArray()" style="background:#0891b2;color:white">Log Array (1000 items)</button>
    </div>

    <script src="../dist/osodreamer-console.umd.js"></script>
    <script>
        // Initialize Console
        const consoleInstance = OsoDreamerConsole.init({
            trigger: { position: 'bottom-right', color: '#3b82f6' }
        });

        function triggerLoop() {
            for (let i = 0; i < 10; i++) {
                console.log("Hello World");
            }
            console.log("Done loop");
        }

        function triggerObjectLoop() {
            const obj = { id: 1, status: 'ok' };
            for (let i = 0; i < 5; i++) {
                console.log("Status update:", obj);
            }
        }

        function throwError() {
            function innerFunction() {
                throw new Error("Critical System Failure: Database Disconnected");
            }
            innerFunction();
        }

        function throwAsyncError() {
            console.log("Starting async operation...");
            setTimeout(() => {
                Promise.reject(new Error("Async Request Timeout (500ms)"));
            }, 500);
        }

        function logDeepObject() {
            console.log({
                user: {
                    name: "Admin",
                    permissions: ["read", "write", "delete"],
                    metadata: {
                        lastLogin: new Date(),
                        session: { id: "xyz-123", active: true }
                    }
                },
                system: {
                    status: "online",
                    metrics: { cpu: 23, memory: "128MB" }
                }
            });
        }

        function startStressTest() {
            console.log("Starting stress test...");
            let count = 0;
            const interval = setInterval(() => {
                console.log(`Log message #${count} - ${new Date().toISOString()}`);
                count++;
                if (count >= 500) {
                    clearInterval(interval);
                    console.log("Stress test finished.");
                }
            }, 5);
        }

        function sendFormData() {
            const fd = new FormData();
            fd.append('username', 'usuario_test');
            fd.append('file', new File(['dummy content'], 'profile.png', { type: 'image/png' }));

            console.log("Sending FormData...", fd);
            // We use a dummy endpoint, it will likely fail 404 but we want to see the Request Body in Console
            fetch('/api/upload', {
                method: 'POST',
                body: fd
            }).catch(e => console.warn("Expected 404/Error, check Network tab for Body details"));
        }

        function sendFetchError() {
            // This domain doesn't exist, should trigger a network error exception
            console.log("fetching http://domain-that-does-not-exist.local...");
            fetch('http://domain-that-does-not-exist.local')
                .then(r => console.log(r))
                .catch(e => console.error("Caught Fetch Error:", e));
        }

        function logLargeArray() {
            const arr = [];
            for (let i = 0; i < 1000; i++) {
                arr.push({ id: i, value: Math.random() });
            }
            console.log("Large Array (1000 items):", arr);
        }

        console.log("Demo Loaded. Click buttons to test features.");
    </script>
</body>

</html>